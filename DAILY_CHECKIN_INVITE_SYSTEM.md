# 每日签到和邀请系统

## 🎯 新增功能

为投票系统添加了两种获取票数的新方式：
1. **每日签到** - 通过每天签到获得投票票数
2. **邀请好友** - 通过邀请新用户获得奖励票数

## 🔧 技术实现

### 1. 数据模型更新 (`models/User.ts`)

#### 新增字段
```typescript
// 每日签到相关
dailyCheckin: {
  lastCheckinDate?: Date;
  consecutiveDays: number;
  totalCheckins: number;
};

// 邀请相关
inviteCode: string; // 用户的邀请码
invitedBy?: string; // 被谁邀请（邀请码）
invitedUsers: string[]; // 邀请的用户钱包地址列表
inviteRewards: {
  totalInvites: number;
  totalRewards: number; // 获得的总奖励票数
};
```

#### 新增方法
- `generateInviteCode()` - 生成8位随机邀请码
- `canCheckinToday()` - 检查是否可以签到
- `performCheckin()` - 执行签到并计算奖励

### 2. API 接口

#### 每日签到 API (`/api/users/checkin`)
- **POST** - 执行签到
- **GET** - 获取签到状态

#### 邀请系统 API (`/api/users/invite`)
- **POST** - 使用邀请码注册
- **GET** - 获取邀请信息

### 3. 前端组件

#### 每日签到组件 (`components/features/DailyCheckin.tsx`)
- 显示签到状态和连续天数
- 签到按钮和奖励预览
- 签到成功动画效果

#### 邀请系统组件 (`components/features/InviteSystem.tsx`)
- 显示邀请码和统计
- 分享邀请链接功能
- 社交媒体分享集成

## 🎁 奖励机制

### 每日签到奖励
- **基础奖励**: 每日签到获得 1 票
- **连续奖励**: 
  - 连续 3 天：2 票
  - 连续 7 天：3 票
- **经验奖励**: 每票获得 5 经验值

### 邀请奖励
- **邀请者**: 每邀请 1 人获得 1 票 + 20 经验
- **被邀请者**: 通过邀请注册获得 2 票
- **成就系统**: 
  - 首次邀请：`first_invite` 成就
  - 邀请 5 人：`invite_master` 成就

## 📱 用户界面

### 投票页面集成
- 在投票统计下方添加"获取更多票数"区域
- 左右布局显示签到和邀请组件
- 只对已连接钱包的用户显示

### 签到界面特点
- 绿色像素风格设计
- 显示连续天数和总签到数
- 实时奖励预览
- 签到成功全屏动画

### 邀请界面特点
- 紫色像素风格设计
- 邀请码复制功能
- 社交媒体分享按钮
- 被邀请用户列表

## 🔄 数据流程

### 签到流程
1. 用户点击签到按钮
2. 检查是否可以签到（每天只能签到一次）
3. 计算连续天数和奖励票数
4. 更新用户数据（票数、经验、签到记录）
5. 显示奖励动画

### 邀请流程
1. 用户分享邀请链接或邀请码
2. 新用户使用邀请码注册
3. 验证邀请码有效性
4. 创建新用户（获得2票）
5. 更新邀请者数据（获得1票+经验）
6. 建立邀请关系

## 🛡️ 安全措施

### 签到安全
- 服务端验证签到时间
- 防止重复签到
- 连续天数计算准确性

### 邀请安全
- 邀请码唯一性验证
- 防止自我邀请
- 钱包地址唯一性检查

## 📊 数据统计

### 签到统计
- 连续签到天数
- 总签到次数
- 签到奖励预览

### 邀请统计
- 邀请人数
- 获得票数
- 被邀请用户列表
- 邀请关系链

## 🔧 兼容性处理

### 现有用户升级
- 自动为现有用户生成邀请码
- 初始化签到和邀请数据结构
- 保持现有数据完整性

### 向后兼容
- 新字段使用默认值
- 渐进式功能启用
- 错误处理和降级

## 🎨 UI/UX 设计

### 视觉风格
- 保持像素风格一致性
- 使用不同颜色区分功能
- 动画效果增强体验

### 交互设计
- 一键复制邀请链接
- 社交分享集成
- 实时状态更新

## 🚀 未来扩展

### 可能的增强功能
- 签到日历视图
- 邀请排行榜
- 更多社交分享平台
- 签到连击奖励
- 邀请等级系统

### 数据分析
- 签到率统计
- 邀请转化率
- 用户活跃度分析
- 奖励效果评估

## ✅ 测试要点

### 功能测试
- [x] 每日签到功能正常
- [x] 连续签到奖励计算正确
- [x] 邀请码生成和验证
- [x] 邀请奖励分配正确
- [x] 现有用户数据升级

### 界面测试
- [x] 组件正确显示
- [x] 动画效果流畅
- [x] 响应式布局适配
- [x] 错误状态处理

### 安全测试
- [x] 重复签到防护
- [x] 无效邀请码处理
- [x] 自我邀请防护
- [x] 数据完整性验证 