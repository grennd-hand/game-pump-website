# 🔒 安全配置指南

## 已修复的安全问题

### 1. ✅ 硬编码凭据问题
- 移除了所有硬编码的数据库连接字符串
- 使用环境变量管理敏感信息
- 创建了安全的配置模板

### 2. ✅ API身份验证
- 添加了JWT身份验证系统
- 实现了管理员权限检查
- 对敏感API端点添加了访问控制

### 3. ✅ 输入验证和清理
- 实现了全面的输入验证
- 添加了XSS防护
- 防止NoSQL注入攻击

### 4. ✅ 业务逻辑安全
- 修复了投票系统的重复投票漏洞
- 添加了权限检查和限流保护
- 实现了事务一致性

### 5. ✅ IDOR防护
- 添加了资源所有权验证
- 实现了访问权限控制
- 防止未授权的数据访问

## 安全最佳实践

### 环境变量配置
```bash
# 请确保设置以下环境变量：
MONGODB_URI=your-actual-database-connection
JWT_SECRET=your-jwt-secret-key
API_SECRET_KEY=your-api-secret
NEXTAUTH_SECRET=your-nextauth-secret
```

### 生产环境部署
1. 更改所有默认密码和密钥
2. 设置正确的CORS域名
3. 启用HTTPS
4. 配置防火墙规则
5. 定期备份数据库

### 监控和审计
- 检查应用日志中的安全审计信息
- 监控异常访问模式
- 定期检查用户权限

### 更新和维护
- 定期更新依赖包
- 监控安全漏洞公告
- 备份和恢复测试

## API安全使用

### 认证头格式
```
Authorization: Bearer your-jwt-token
X-API-Key: your-api-key
```

### 管理员API访问
管理员API需要：
1. 有效的JWT token
2. isAdmin权限标记
3. 可选的IP白名单验证

### 限流规则
- 一般API：每分钟100次请求
- 投票API：每分钟5次请求
- 敏感操作：每分钟10次请求

## 紧急响应

如发现安全问题：
1. 立即禁用受影响的功能
2. 检查日志文件
3. 更改相关密钥
4. 通知用户（如需要）

## 安全检查清单

- [ ] 所有环境变量已正确设置
- [ ] 默认密码已更改
- [ ] 数据库访问权限最小化
- [ ] API访问已限制
- [ ] 日志监控已启用
- [ ] 备份策略已实施
